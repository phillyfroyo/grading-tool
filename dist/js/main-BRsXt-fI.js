!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const e=new class{constructor(){this.events=new Map,this.modules=new Map,this.debugMode=!1}registerModule(e,t){this.modules.set(e,t),this.log(`Module registered: ${e}`)}getModule(e){return this.modules.get(e)||null}on(e,t,o=null){this.events.has(e)||this.events.set(e,[]),this.events.get(e).push({callback:t,context:o,once:!1}),this.log(`Event listener added: ${e}`)}once(e,t,o=null){this.events.has(e)||this.events.set(e,[]),this.events.get(e).push({callback:t,context:o,once:!0}),this.log(`One-time event listener added: ${e}`)}off(e,t){if(!this.events.has(e))return;const o=this.events.get(e),n=o.findIndex(e=>e.callback===t);-1!==n&&(o.splice(n,1),this.log(`Event listener removed: ${e}`)),0===o.length&&this.events.delete(e)}emit(e,t=null){if(this.log(`Event emitted: ${e}`,t),!this.events.has(e))return this.log(`No listeners for event: ${e}`),!1;const o=this.events.get(e),n=[];return o.forEach((o,i)=>{try{o.context?o.callback.call(o.context,t):o.callback(t),o.once&&n.push(i)}catch(l){console.error(`Error in event listener for ${e}:`,l)}}),n.reverse().forEach(e=>{o.splice(e,1)}),0===o.length&&this.events.delete(e),!0}request(e,t=null){return new Promise((o,n)=>{const i=`${e}:response:${Date.now()}`;this.once(i,e=>{o(e)}),this.emit(e,{data:t,responseEvent:i}),setTimeout(()=>{n(new Error(`Request timeout for event: ${e}`))},5e3)})}respond(e,t){e&&e.responseEvent&&this.emit(e.responseEvent,t)}setDebugMode(e){this.debugMode=e}log(e,t=null){this.debugMode&&(null!==t?console.log(`[EventBus] ${e}`,t):console.log(`[EventBus] ${e}`))}getDebugInfo(){return{registeredModules:Array.from(this.modules.keys()),activeEvents:Array.from(this.events.keys()),eventListenerCounts:Object.fromEntries(Array.from(this.events.entries()).map(([e,t])=>[e,t.length]))}}clear(){this.events.clear(),this.modules.clear(),this.log("Event bus cleared")}};"undefined"!=typeof window&&(window.eventBus=e);class t{constructor(e="App",t="info"){this.moduleName=e,this.level=t,this.levels={debug:0,info:1,warn:2,error:3,silent:4},this.colors={debug:"#6c757d",info:"#007bff",warn:"#ffc107",error:"#dc3545"}}setLevel(e){this.levels.hasOwnProperty(e)&&(this.level=e)}shouldLog(e){return this.levels[e]>=this.levels[this.level]}formatMessage(e,t,o=null){const n=(new Date).toISOString().split("T")[1].slice(0,-1),i=this.colors[e]||"#000000",l=[`%c[${n}] [${this.moduleName}] ${e.toUpperCase()}: ${t}`,`color: ${i}; font-weight: bold;`];return null!==o&&l.push(o),l}debug(e,t=null){this.shouldLog("debug")&&console.log(...this.formatMessage("debug",e,t))}info(e,t=null){this.shouldLog("info")&&console.log(...this.formatMessage("info",e,t))}warn(e,t=null){this.shouldLog("warn")&&console.warn(...this.formatMessage("warn",e,t))}error(e,t=null){this.shouldLog("error")&&console.error(...this.formatMessage("error",e,t))}enter(e,t=null){this.debug(`→ ${e}()`,t)}exit(e,t=null){this.debug(`← ${e}()`,t)}time(e){const t=performance.now();return console.time(`[${this.moduleName}] ${e}`),{end:()=>{const o=performance.now()-t;return console.timeEnd(`[${this.moduleName}] ${e}`),this.debug(`${e} completed in ${o.toFixed(2)}ms`),o}}}group(e,t,o=!1){if(this.shouldLog("debug")){o?console.groupCollapsed(`[${this.moduleName}] ${e}`):console.group(`[${this.moduleName}] ${e}`);try{t()}finally{console.groupEnd()}}else t()}table(e,t="Data"){this.shouldLog("debug")&&(this.debug(t),console.table(e))}child(e){return new t(`${this.moduleName}:${e}`,this.level)}}function o(e,o="info"){return new t(e,o)}const n=new t("App");"undefined"!=typeof window&&(window.logger=n,window.createLogger=o);const i=o("Core:EventDelegation");const l=new class{constructor(){this.handlers=new Map,this.initialized=!1}initialize(){this.initialized?i.warn("Event delegation already initialized"):(i.info("Initializing event delegation system"),document.addEventListener("click",this.handleGlobalClick.bind(this),!0),this.registerStandardHandlers(),this.initialized=!0,i.info("Event delegation system initialized"))}handleGlobalClick(e){const t=e.target,o=t.dataset.action;if(o&&this.handlers.has(o)){e.preventDefault();return void this.handlers.get(o)(e,t)}this.handleClassBasedActions(e,t)}handleClassBasedActions(e,t){if(t.id?.includes("clearSelectionBtn")){e.preventDefault();const o=t.id.includes("-")?parseInt(t.id.split("-")[1]):void 0;return void this.handleClearSelection(o)}if(t.textContent?.includes("Export to PDF"))return e.preventDefault(),void this.handleExportToPDF();if(t.textContent?.includes("Download All Essays"))return e.preventDefault(),void this.handleDownloadAllEssays();if(t.textContent?.includes("Download")&&t.onclick?.toString().includes("downloadIndividualEssay")){e.preventDefault();const o=t.onclick.toString().match(/downloadIndividualEssay\((\d+)\)/);return void(o&&this.handleDownloadIndividualEssay(parseInt(o[1])))}if(t.onclick?.toString().includes("toggleStudentDetails")){e.preventDefault();const o=t.onclick.toString().match(/toggleStudentDetails\((\d+)\)/);return void(o&&this.handleToggleStudentDetails(parseInt(o[1])))}if(t.onclick?.toString().includes("showProfileForm")){e.preventDefault();const o=t.onclick.toString().match(/showProfileForm\('([^']+)'\)/),n=o?o[1]:void 0;return void this.handleShowProfileForm(n)}if(t.onclick?.toString().includes("deleteProfile")){e.preventDefault();const o=t.onclick.toString().match(/deleteProfile\('([^']+)'\)/);return void(o&&this.handleDeleteProfile(o[1]))}if(t.onclick?.toString().includes("removeEssay")){e.preventDefault();const o=t.onclick.toString().match(/removeEssay\((\d+)\)/);return void(o&&this.handleRemoveEssay(parseInt(o[1])))}if(t.onclick?.toString().includes("saveManualGrading"))return e.preventDefault(),void this.handleSaveManualGrading();if(t.onclick?.toString().includes("cancelManualGrading"))return e.preventDefault(),void this.handleCancelManualGrading();if(t.onclick?.toString().includes("editTeacherNotes"))return e.preventDefault(),void this.handleEditTeacherNotes(t);if(t.onclick?.toString().includes("editStat")){e.preventDefault();const o=t.onclick.toString().match(/editStat\(this,\s*'([^']+)'\)/);return void(o&&this.handleEditStat(t,o[1]))}}registerHandler(e,t){this.handlers.set(e,t),i.debug(`Registered handler for action: ${e}`)}registerStandardHandlers(){this.registerHandler("close-modal",(e,t)=>{const o=t.closest(".modal")?.id;if(o&&window.ModalManager){const e=o.replace("Modal","");window.ModalManager.closeModal(e)}}),this.registerHandler("save-modal",(e,t)=>{const o=t.closest(".modal")?.id;if(o&&window.ModalManager){const e=o.replace("Modal","");window.ModalManager.saveModal(e)}}),this.registerHandler("select-category",(e,t)=>{const o=t.dataset.category;o&&window.CategorySelectionModule&&window.CategorySelectionModule.selectCategory(o)}),this.registerHandler("clear-selection",(e,t)=>{const o=t.dataset.essayIndex?parseInt(t.dataset.essayIndex):void 0;this.handleClearSelection(o)})}handleClearSelection(e){"function"==typeof clearSelection?clearSelection(e):i.warn("clearSelection function not found")}handleExportToPDF(){"function"==typeof exportToPDF?exportToPDF():"function"==typeof exportManualResults?exportManualResults():i.warn("Export function not found")}handleDownloadAllEssays(){"function"==typeof downloadAllEssays?downloadAllEssays():i.warn("downloadAllEssays function not found")}handleDownloadIndividualEssay(e){"function"==typeof downloadIndividualEssay?downloadIndividualEssay(e):i.warn("downloadIndividualEssay function not found")}handleToggleStudentDetails(e){"function"==typeof toggleStudentDetails?toggleStudentDetails(e):i.warn("toggleStudentDetails function not found")}handleShowProfileForm(e){"function"==typeof showProfileForm?showProfileForm(e):i.warn("showProfileForm function not found")}handleDeleteProfile(e){"function"==typeof deleteProfile?deleteProfile(e):i.warn("deleteProfile function not found")}handleRemoveEssay(e){"function"==typeof removeEssay?removeEssay(e):i.warn("removeEssay function not found")}handleSaveManualGrading(){"function"==typeof saveManualGrading?saveManualGrading():i.warn("saveManualGrading function not found")}handleCancelManualGrading(){"function"==typeof cancelManualGrading?cancelManualGrading():i.warn("cancelManualGrading function not found")}handleEditTeacherNotes(e){"function"==typeof editTeacherNotes?editTeacherNotes(e):window.ModalManager?window.ModalManager.openTeacherNotesModal(e):i.warn("editTeacherNotes function not found")}handleEditStat(e,t){"function"==typeof editStat?editStat(e,t):i.warn("editStat function not found")}destroy(){this.initialized&&(document.removeEventListener("click",this.handleGlobalClick.bind(this),!0),this.handlers.clear(),this.initialized=!1,i.info("Event delegation system destroyed"))}};"undefined"!=typeof window&&(window.EventDelegation=l);const s=o("UI:Modals");const a=new class{constructor(){this.activeModal=null,this.modals=new Map,this.modalStack=[]}initialize(){s.info("Initializing modal functionality"),this.registerModals(),this.setupEventListeners(),this.setupKeyboardHandlers(),e.registerModule("ModalManager",this)}registerModals(){this.registerModal("teacherNotes",{element:document.getElementById("teacherNotesModal"),handlers:{open:this.openTeacherNotesModal.bind(this),close:this.closeTeacherNotesModal.bind(this),save:this.saveTeacherNotes.bind(this)}}),this.registerModal("editHighlight",{element:document.getElementById("editModal"),handlers:{open:this.openEditModal.bind(this),close:this.closeEditModal.bind(this),save:this.saveEditModal.bind(this)}});const e=document.getElementById("profileModal");e&&this.registerModal("profileManagement",{element:e,handlers:{open:this.openProfileModal.bind(this),close:this.closeProfileModal.bind(this)}})}registerModal(e,t){if(!t.element)return void s.warn(`Modal element not found for: ${e}`);this.modals.set(e,{id:e,element:t.element,handlers:t.handlers||{},data:{}});const o=t.element.querySelector(".modal-close-btn");o&&o.addEventListener("click",()=>this.closeModal(e));const n=t.element.querySelector(".modal-save-btn");n&&n.addEventListener("click",()=>this.saveModal(e));const i=t.element.querySelector(".modal-cancel-btn");i&&i.addEventListener("click",()=>this.closeModal(e));const l=t.element.querySelector(".modal-remove-btn");l&&l.addEventListener("click",()=>this.removeHighlight(e)),s.debug(`Registered modal: ${e}`)}setupEventListeners(){e.on("modal:open",e=>{this.openModal(e.modalId,e.config)}),e.on("modal:close",e=>{e.modalId?this.closeModal(e.modalId):this.closeActiveModal()}),e.on("modal:save",e=>{this.saveModal(e.modalId||this.activeModal)}),e.on("teacher-notes:open",e=>{this.openTeacherNotesModal(e.element)}),e.on("highlight:edit",e=>{this.openEditModal(e.element,e.category,e.notes)})}setupKeyboardHandlers(){document.addEventListener("keydown",e=>{if(this.activeModal)switch(e.key){case"Escape":e.preventDefault(),this.closeActiveModal();break;case"Enter":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.saveModal(this.activeModal))}})}openModal(t,o={}){const n=this.modals.get(t);return n?(s.info(`Opening modal: ${t}`),this.activeModal&&(this.modalStack.push(this.activeModal),this.closeModal(this.activeModal,!1)),n.element.style.display="block",n.data={...o},this.activeModal=t,n.handlers.open&&n.handlers.open(o),this.setupBackdropClick(n.element),this.makeDraggable(n.element),e.emit("modal:opened",{modalId:t}),!0):(s.error(`Modal not found: ${t}`),!1)}closeModal(t,o=!0){const n=this.modals.get(t);if(!n)return s.error(`Modal not found: ${t}`),!1;if(s.info(`Closing modal: ${t}`),n.element.style.display="none",n.data={},n.element._dragCleanup&&n.element._dragCleanup(),n.handlers.close&&n.handlers.close(),this.activeModal===t&&(this.activeModal=null,o&&this.modalStack.length>0)){const e=this.modalStack.pop();this.openModal(e)}return e.emit("modal:closed",{modalId:t}),!0}closeActiveModal(){this.activeModal&&this.closeModal(this.activeModal)}saveModal(t){const o=this.modals.get(t);return o?(s.info(`Saving modal: ${t}`),o.handlers.save&&o.handlers.save(),e.emit("modal:saved",{modalId:t}),!0):(s.error(`Modal not found: ${t}`),!1)}removeHighlight(e){const t=this.modals.get(e);if(!t)return s.error(`Modal not found: ${e}`),!1;if(s.info(`Removing highlight from modal: ${e}`),"editHighlight"===e){const o=t.element.dataset.editingElement;if(o&&window.HighlightingModule){const t=document.getElementById(o);if(t)return window.HighlightingModule.removeHighlight(t),this.closeModal(e),!0}}return s.warn(`Could not remove highlight for modal: ${e}`),!1}setupBackdropClick(e){e.addEventListener("click",t=>{t.target===e&&this.closeActiveModal()})}makeDraggable(e){const t=e.querySelector(".modal-content"),o=e.querySelector(".modal-header");if(!t||!o)return;let n,i,l,s,a=!1,d=0,r=0;t.style.position="absolute",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",o.style.cursor="move",o.style.userSelect="none";const c=e=>{"touchstart"===e.type?(l=e.touches[0].clientX-d,s=e.touches[0].clientY-r):(l=e.clientX-d,s=e.clientY-r),(e.target===o||o.contains(e.target))&&(a=!0,t.style.transition="none")},u=()=>{a=!1,t.style.transition=""},h=e=>{a&&(e.preventDefault(),"touchmove"===e.type?(n=e.touches[0].clientX-l,i=e.touches[0].clientY-s):(n=e.clientX-l,i=e.clientY-s),d=n,r=i,t.style.transform=`translate(calc(-50% + ${n}px), calc(-50% + ${i}px))`)};o.addEventListener("mousedown",c),document.addEventListener("mousemove",h),document.addEventListener("mouseup",u),o.addEventListener("touchstart",c),document.addEventListener("touchmove",h),document.addEventListener("touchend",u),e._dragCleanup=()=>{o.removeEventListener("mousedown",c),document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",u),o.removeEventListener("touchstart",c),document.removeEventListener("touchmove",h),document.removeEventListener("touchend",u)}}openTeacherNotesModal(e){const t=this.modals.get("teacherNotes");if(!t)return;const o=e.dataset.teacherNotes||"",n=document.getElementById("teacherNotesText");n&&(n.value=o),t.element.dataset.targetElement=e.id,this.openModal("teacherNotes",{targetElement:e})}closeTeacherNotesModal(){this.closeModal("teacherNotes")}saveTeacherNotes(){const t=this.modals.get("teacherNotes"),o=t?.element.dataset.targetElement,n=document.getElementById("teacherNotesText"),i=n?.value||"";if(o){const t=document.getElementById(o);t&&(t.dataset.teacherNotes=i,i.trim()?(t.style.backgroundColor="#fff3cd",t.title="Teacher notes: "+i.substring(0,100)+(i.length>100?"...":"")):(t.style.backgroundColor="",t.title=""),e.emit("teacher-notes:saved",{element:t,notes:i}))}this.closeTeacherNotesModal()}openEditModal(e,t="",o=""){const n=this.modals.get("editHighlight");if(!n)return;const i=document.getElementById("editCategory"),l=document.getElementById("editNotes");i&&(i.value=t||e.dataset.category||"grammar"),l&&(l.value=o||e.dataset.notes||""),n.element.dataset.editingElement=e.id,this.openModal("editHighlight",{targetElement:e,category:t,notes:o})}closeEditModal(){this.closeModal("editHighlight")}saveEditModal(){const t=this.modals.get("editHighlight"),o=document.getElementById("editModal"),n=document.getElementById("editNotes"),i=o?.dataset?.selectedCategories||"",l=i?i.split(",").filter(e=>e.trim()):[],a=n?.value||"";s.debug("Saving highlight edit:",{categories:l,notes:a});const d=t?.element.dataset?.editingElement;if(d){const t=document.getElementById(d);if(t){t.dataset.category=l.join(","),t.dataset.notes=a;const o=l[0]||"grammar";window.HighlightingModule&&window.HighlightingModule.updateHighlightVisualStyling(t,o),e.emit("highlight:updated",{element:t,categories:l,notes:a}),s.debug("Updated highlight element:",t)}else s.error("Could not find element to update:",d)}else s.error("No element ID stored for editing");this.closeEditModal()}openProfileModal(e={}){s.info("Profile modal opened",e)}closeProfileModal(){this.closeModal("profileManagement")}getActiveModal(){return this.activeModal}hasModal(e){return this.modals.has(e)}destroy(){this.modals.clear(),this.modalStack=[],this.activeModal=null,s.info("Modal manager destroyed")}};"undefined"!=typeof window&&(window.ModalManager=a,window.openTeacherNotesModal=e=>a.openTeacherNotesModal(e),window.closeTeacherNotesModal=()=>a.closeTeacherNotesModal(),window.saveTeacherNotes=()=>a.saveTeacherNotes(),window.closeEditModal=()=>a.closeEditModal(),window.saveEditModal=()=>a.saveEditModal());const d=o("App:Main");const r=new class{constructor(){this.initialized=!1,this.modules=new Map}async initialize(){if(this.initialized)d.warn("Application already initialized");else{d.info("🚀 Initializing modern application...");try{await this.initializeCore(),await this.initializeUI(),await this.initializeFeatures(),this.setupErrorHandling(),this.initialized=!0,d.info("✅ Modern application initialized successfully"),this.logModuleStatus()}catch(e){throw d.error("❌ Failed to initialize application:",e),e}}}async initializeCore(){d.info("Initializing core systems..."),e&&"function"==typeof e.initialize&&(e.initialize(),this.modules.set("eventBus",e)),l&&"function"==typeof l.initialize&&(l.initialize(),this.modules.set("eventDelegation",l)),d.info("✅ Core systems initialized")}async initializeUI(){d.info("Initializing UI systems..."),a&&"function"==typeof a.initialize&&(a.initialize(),this.modules.set("modalManager",a)),window.TabManagementModule&&"function"==typeof window.TabManagementModule.initialize&&(window.TabManagementModule.initialize(),this.modules.set("tabManagement",window.TabManagementModule)),window.FormHandlingModule&&"function"==typeof window.FormHandlingModule.setupManualGrading&&(window.FormHandlingModule.setupManualGrading(),this.modules.set("formHandling",window.FormHandlingModule)),d.info("✅ UI systems initialized")}async initializeFeatures(){d.info("Initializing feature modules..."),window.GradingDisplayModule&&"function"==typeof window.GradingDisplayModule.initializeGradingDisplay&&(window.GradingDisplayModule.initializeGradingDisplay(),this.modules.set("gradingDisplay",window.GradingDisplayModule)),window.HighlightingModule&&this.modules.set("highlighting",window.HighlightingModule),window.TextSelectionModule&&this.modules.set("textSelection",window.TextSelectionModule),window.CategorySelectionModule&&this.modules.set("categorySelection",window.CategorySelectionModule),window.EssayEditingModule&&this.modules.set("essayEditing",window.EssayEditingModule),window.ProfilesModule&&this.modules.set("profiles",window.ProfilesModule),window.PDFExportModule&&this.modules.set("pdfExport",window.PDFExportModule),d.info("✅ Feature modules initialized")}setupErrorHandling(){window.addEventListener("error",e=>{d.error("Global error caught:",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,error:e.error})}),window.addEventListener("unhandledrejection",e=>{d.error("Unhandled promise rejection:",e.reason)}),window.addEventListener("error",e=>{"SCRIPT"===e.target.tagName&&d.error("Script loading error:",{src:e.target.src,error:e})},!0),d.info("✅ Global error handling set up")}logModuleStatus(){const e={};this.modules.forEach((t,o)=>{e[o]=!!t}),e.legacy={UIInteractionsModule:!!window.UIInteractionsModule,EssayManagementModule:!!window.EssayManagementModule,BatchProcessingModule:!!window.BatchProcessingModule,DisplayUtilsModule:!!window.DisplayUtilsModule},d.info("📊 Module status:",e)}getModule(e){return this.modules.get(e)||null}isInitialized(){return this.initialized}destroy(){d.info("🔄 Destroying application..."),this.modules.forEach((e,t)=>{if(e&&"function"==typeof e.destroy)try{e.destroy(),d.debug(`Destroyed module: ${t}`)}catch(o){d.error(`Error destroying module ${t}:`,o)}}),this.modules.clear(),this.initialized=!1,d.info("✅ Application destroyed")}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{r.initialize()}):r.initialize(),window.App=r;
//# sourceMappingURL=main-BRsXt-fI.js.map
