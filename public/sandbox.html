<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Sandbox - ESL Grading</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #0f172a;
            font-size: 2rem;
            font-weight: 700;
        }

        .sandbox-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .panel h2 {
            margin-bottom: 15px;
            color: #374151;
            font-size: 1.2rem;
            font-weight: 600;
        }

        textarea {
            width: 100%;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 12px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 13px;
            line-height: 1.5;
            resize: vertical;
            background-color: #f9fafb;
        }

        #promptInput {
            height: 300px;
        }

        #studentText {
            height: 200px;
        }

        .button-row {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        button:hover {
            background: #2563eb;
        }

        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .template-btn {
            background: #10b981;
        }

        .template-btn:hover {
            background: #059669;
        }

        .clear-btn {
            background: #ef4444;
        }

        .clear-btn:hover {
            background: #dc2626;
        }

        .results {
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        #results {
            height: 400px;
            background-color: #f9fafb;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 13px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #6b7280;
        }

        .error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .template-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .template-list button {
            padding: 6px 12px;
            font-size: 12px;
        }

        .word-count {
            font-size: 12px;
            color: #6b7280;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ§ª Prompt Sandbox</h1>
        
        <div class="sandbox-grid">
            <div class="panel">
                <h2>Prompt Template</h2>
                <div class="template-list">
                    <button class="template-btn" onclick="loadTemplate('simple')">Simple</button>
                    <button class="template-btn" onclick="loadTemplate('minimal')">Minimal</button>
                    <button class="template-btn" onclick="loadTemplate('structured')">Structured</button>
                    <button class="template-btn" onclick="loadTemplate('current')">Current</button>
                </div>
                <textarea id="promptInput" placeholder="Enter your prompt here..."></textarea>
                <div class="word-count" id="promptWordCount">0 words</div>
            </div>

            <div class="panel">
                <h2>Student Essay</h2>
                <textarea id="studentText" placeholder="Enter student essay to test...">I feel too happy to can talk with you about this topic. If you work hard you will have success in your life. If you take care with your money, you wont an a BAKRUPT. I want to is create an a new BUSSINES PLAN for the company and all of my advices and tips that I have been use for many years will help you.</textarea>
                <div class="word-count" id="essayWordCount">0 words</div>
            </div>
        </div>

        <div class="button-row">
            <button onclick="testPrompt()">ðŸš€ Test Prompt</button>
            <button class="clear-btn" onclick="clearResults()">Clear Results</button>
        </div>

        <div class="panel results">
            <h2>Results</h2>
            <textarea id="results" readonly placeholder="Results will appear here..."></textarea>
        </div>
    </div>

    <script>
        const templates = {
            simple: `Find all errors in this essay and return them as JSON.

Categories: spelling, vocabulary, grammar, mechanics, fluency

Return format:
{
  "inline_issues": [
    {"category": "spelling", "text": "misspelled", "start": 0, "end": 10, "correction": "corrected", "explanation": "reason"}
  ]
}`,

            minimal: `Grade this essay. Find individual errors (max 3 words each). Return JSON only.`,

            structured: `You are grading an ESL essay. Find specific errors:
- spelling: misspelled words  
- vocabulary: wrong words
- grammar: tense, agreement, structure errors
- mechanics: punctuation, capitalization
- fluency: awkward but correct phrases

Rules:
- Mark individual errors only (1-3 words max)
- Each error = separate JSON object
- Be precise and specific

Return JSON format:
{"inline_issues": [{"category": "grammar", "text": "error", "start": 0, "end": 5, "correction": "fix", "explanation": "why"}]}`,

            current: `You are an expert ESL writing grader. Your task is to analyze the student's essay and return detailed feedback.

## GOAL
You are a precision error detection tool. Your job is to identify **individual, specific errors** - NOT to fix sentences.

**THINK LIKE A COPY EDITOR:** Circle each mistake individually, don't rewrite sentences.

---

## CATEGORIES
- spelling â€” misspelled words
- vocabulary-structure â€” wrong word, collocation, or part of speech
- grammar â€” tense, agreement, articles, prepositions, modals, sentence structure
- mechanics-punctuation â€” capitalization, commas, periods, run-ons, missing apostrophes
- fluency / rephrasing â€” naturalness coaching for awkward but technically correct language

Return JSON only:
{"inline_issues": [{"category": "grammar", "text": "error", "start": 0, "end": 5, "correction": "fix", "explanation": "reason"}]}`
        };

        function loadTemplate(templateName) {
            document.getElementById('promptInput').value = templates[templateName];
            updateWordCount('promptInput', 'promptWordCount');
        }

        function updateWordCount(textareaId, countId) {
            const text = document.getElementById(textareaId).value;
            const wordCount = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
            document.getElementById(countId).textContent = `${wordCount} words`;
        }

        // Update word counts on input
        document.getElementById('promptInput').addEventListener('input', () => {
            updateWordCount('promptInput', 'promptWordCount');
        });

        document.getElementById('studentText').addEventListener('input', () => {
            updateWordCount('studentText', 'essayWordCount');
        });

        // Initialize word counts
        updateWordCount('promptInput', 'promptWordCount');
        updateWordCount('studentText', 'essayWordCount');

        async function testPrompt() {
            const prompt = document.getElementById('promptInput').value.trim();
            const studentText = document.getElementById('studentText').value.trim();
            const resultsArea = document.getElementById('results');

            if (!prompt || !studentText) {
                resultsArea.value = 'Error: Please provide both a prompt and student essay.';
                return;
            }

            // Show loading state
            resultsArea.value = 'Testing prompt... This may take 10-30 seconds.';
            
            try {
                const response = await fetch('/api/sandbox/test-prompt', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        studentText: studentText
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                
                if (result.error) {
                    resultsArea.value = `Error: ${result.error}`;
                } else {
                    resultsArea.value = JSON.stringify(result, null, 2);
                }
            } catch (error) {
                resultsArea.value = `Error testing prompt: ${error.message}`;
            }
        }

        function clearResults() {
            document.getElementById('results').value = '';
        }

        // Load simple template by default
        loadTemplate('simple');
    </script>
</body>
</html>